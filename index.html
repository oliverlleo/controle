<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gerenciamento Financeiro</title>
  
  <!-- Meta tags para evitar cache -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS do Daterangepicker -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Ícones (Font Awesome) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- CSS Personalizado -->
  <link rel="stylesheet" href="css/responsive_layout.css">
  <link rel="stylesheet" href="css/enhanced_styles.css">
</head>
<body>
  <!-- Verificação de Autenticação -->
  <div id="loading-screen">
    <div class="loading-content">
      <i class="fas fa-wallet loading-logo"></i>
      <h2>FinanControl</h2>
      <div class="loading-spinner"></div>
      <p>Verificando autenticação...</p>
    </div>
  </div>

  <!-- Navegação Lateral -->
  <aside id="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <i class="fas fa-wallet"></i> FinanControl
      </div>
      <button id="toggleSidebar" class="toggle-sidebar">
        <i class="fas fa-bars"></i>
      </button>
    </div>
    
    <div class="user-profile">
      <div class="user-avatar">
        <img id="userAvatar" src="https://via.placeholder.com/50" alt="Avatar do usuário">
      </div>
      <div class="user-info">
        <div id="userName">Carregando...</div>
        <div id="userEmail" class="user-email">...</div>
      </div>
    </div>
    
    <nav class="sidebar-nav">
      <ul>
        <li class="active" data-section="dashboard">
          <a href="#dashboard"><i class="fas fa-home"></i> <span>Dashboard</span></a>
        </li>
        <li data-section="expenses">
          <a href="#expenses"><i class="fas fa-receipt"></i> <span>Despesas</span></a>
        </li>
        <li data-section="reports">
          <a href="#reports"><i class="fas fa-chart-pie"></i> <span>Relatórios</span></a>
        </li>
        <li data-section="categories">
          <a href="#categories"><i class="fas fa-tags"></i> <span>Categorias</span></a>
        </li>
        <li data-section="cards">
          <a href="#cards"><i class="fas fa-credit-card"></i> <span>Cartões</span></a>
        </li>
        <li data-section="income">
          <a href="#income"><i class="fas fa-money-bill-wave"></i> <span>Renda</span></a>
        </li>
        <li data-section="goals">
          <a href="#goals"><i class="fas fa-bullseye"></i> <span>Metas</span></a>
        </li>
        <li data-section="budget">
          <a href="#budget"><i class="fas fa-balance-scale"></i> <span>Orçamento</span></a>
        </li>
        <li data-section="trends">
          <a href="#trends"><i class="fas fa-chart-line"></i> <span>Tendências</span></a>
        </li>
        <li data-section="cashflow">
          <a href="#cashflow"><i class="fas fa-exchange-alt"></i> <span>Fluxo de Caixa</span></a>
        </li>
        <li data-section="comparison">
          <a href="#comparison"><i class="fas fa-balance-scale-right"></i> <span>Comparativo</span></a>
        </li>
      </ul>
    </nav>
    
    <div class="sidebar-footer">
      <button id="themeToggle" class="theme-toggle">
        <i class="fas fa-moon"></i> <span>Tema Escuro</span>
      </button>
      <button id="logoutBtn" class="logout-btn">
        <i class="fas fa-sign-out-alt"></i> <span>Sair</span>
      </button>
    </div>
  </aside>
  
  <!-- Navegação Inferior (Mobile) -->
  <nav id="bottom-nav">
    <a href="#dashboard" class="active" data-section="dashboard">
      <i class="fas fa-home"></i>
      <span>Início</span>
    </a>
    <a href="#expenses" data-section="expenses">
      <i class="fas fa-receipt"></i>
      <span>Despesas</span>
    </a>
    <a href="#reports" data-section="reports">
      <i class="fas fa-chart-pie"></i>
      <span>Relatórios</span>
    </a>
    <a href="#" id="moreBtn">
      <i class="fas fa-ellipsis-h"></i>
      <span>Mais</span>
    </a>
  </nav>
  
  <!-- Menu Mais (Mobile) -->
  <div id="moreMenu" class="more-menu">
    <div class="more-menu-header">
      <h3>Mais opções</h3>
      <button id="closeMoreMenu"><i class="fas fa-times"></i></button>
    </div>
    <div class="more-menu-content">
      <a href="#categories" data-section="categories">
        <i class="fas fa-tags"></i> Categorias
      </a>
      <a href="#cards" data-section="cards">
        <i class="fas fa-credit-card"></i> Cartões
      </a>
      <a href="#income" data-section="income">
        <i class="fas fa-money-bill-wave"></i> Renda
      </a>
      <a href="#goals" data-section="goals">
        <i class="fas fa-bullseye"></i> Metas
      </a>
      <a href="#budget" data-section="budget">
        <i class="fas fa-balance-scale"></i> Orçamento
      </a>
      <a href="#trends" data-section="trends">
        <i class="fas fa-chart-line"></i> Tendências
      </a>
      <a href="#cashflow" data-section="cashflow">
        <i class="fas fa-exchange-alt"></i> Fluxo de Caixa
      </a>
      <a href="#comparison" data-section="comparison">
        <i class="fas fa-balance-scale-right"></i> Comparativo
      </a>
      <div class="more-menu-divider"></div>
      <a href="#" id="mobileThemeToggle">
        <i class="fas fa-moon"></i> Tema Escuro
      </a>
      <a href="#" id="mobileLogout">
        <i class="fas fa-sign-out-alt"></i> Sair
      </a>
    </div>
  </div>
  
  <!-- Conteúdo Principal -->
  <main>
    <!-- Barra Superior -->
    <header class="top-bar">
      <div class="top-bar-left">
        <button id="mobileSidebarToggle" class="mobile-sidebar-toggle">
          <i class="fas fa-bars"></i>
        </button>
        <h1 id="pageTitle">Dashboard</h1>
      </div>
      <div class="top-bar-right">
        <button id="notificationsBtn" class="notifications-btn">
          <i class="fas fa-bell"></i>
          <span id="notificationCount" class="notification-badge">0</span>
        </button>
        <div class="user-dropdown">
          <button id="userDropdownBtn" class="user-dropdown-btn">
            <img id="userAvatarSmall" src="https://via.placeholder.com/32" alt="Avatar">
            <span id="userNameSmall">Usuário</span>
            <i class="fas fa-chevron-down"></i>
          </button>
          <div id="userDropdownMenu" class="user-dropdown-menu">
            <a href="#profile"><i class="fas fa-user"></i> Perfil</a>
            <a href="#settings"><i class="fas fa-cog"></i> Configurações</a>
            <a href="#" id="exportDataBtn"><i class="fas fa-file-export"></i> Exportar Dados</a>
            <div class="dropdown-divider"></div>
            <a href="#" id="headerLogoutBtn"><i class="fas fa-sign-out-alt"></i> Sair</a>
          </div>
        </div>
      </div>
    </header>
    
    <!-- Conteúdo das Seções -->
    <div class="content-wrapper">
      <!-- Dashboard -->
      <section id="dashboard-section" class="content-section active">
        <div class="section-header">
          <h2>Visão Geral</h2>
          <div class="date-filter">
            <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
            <span id="currentMonth">Carregando...</span>
            <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
          </div>
        </div>
        
        <!-- Cards de Resumo -->
        <div class="grid">
          <div class="stat-card">
            <div class="stat-card-icon success">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="stat-card-content">
              <div class="stat-card-title">Renda</div>
              <div class="stat-card-value" id="totalIncome">R$ 0,00</div>
              <div class="stat-card-trend" id="incomeTrend">
                <i class="fas fa-arrow-up"></i> 0%
              </div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-card-icon danger">
              <i class="fas fa-receipt"></i>
            </div>
            <div class="stat-card-content">
              <div class="stat-card-title">Despesas</div>
              <div class="stat-card-value" id="totalExpenses">R$ 0,00</div>
              <div class="stat-card-trend" id="expensesTrend">
                <i class="fas fa-arrow-down"></i> 0%
              </div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-card-icon primary">
              <i class="fas fa-wallet"></i>
            </div>
            <div class="stat-card-content">
              <div class="stat-card-title">Saldo</div>
              <div class="stat-card-value" id="balance">R$ 0,00</div>
              <div class="stat-card-trend" id="balanceTrend">
                <i class="fas fa-equals"></i> 0%
              </div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-card-icon warning">
              <i class="fas fa-credit-card"></i>
            </div>
            <div class="stat-card-content">
              <div class="stat-card-title">Cartões</div>
              <div class="stat-card-value" id="cardExpenses">R$ 0,00</div>
              <div class="stat-card-trend" id="cardTrend">
                <i class="fas fa-arrow-right"></i> 0%
              </div>
            </div>
          </div>
        </div>
        
        <!-- Gráficos -->
        <div class="grid">
          <div class="card grid-col-2">
            <div class="card-header">
              <div class="card-title">Despesas por Categoria</div>
              <div class="card-actions">
                <button class="btn-icon" id="refreshCategoryChart">
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <canvas id="categoryChart"></canvas>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">Despesas Recentes</div>
              <div class="card-actions">
                <button class="btn-icon" id="refreshRecentExpenses">
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div id="recentExpenses" class="recent-expenses">
                <div class="text-center">
                  <div class="spinner"></div>
                  <p>Carregando despesas...</p>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary" onclick="abrirModal('despesaModal')">
                <i class="fas fa-plus"></i> Nova Despesa
              </button>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">Próximos Vencimentos</div>
              <div class="card-actions">
                <button class="btn-icon" id="refreshUpcomingDues">
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div id="upcomingDues" class="upcoming-dues">
                <div class="text-center">
                  <div class="spinner"></div>
                  <p>Carregando vencimentos...</p>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-outline" onclick="mostrarTodos('vencimentos')">
                Ver Todos
              </button>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">Metas Financeiras</div>
              <div class="card-actions">
                <button class="btn-icon" id="refreshGoals">
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div id="dashboardGoals" class="dashboard-goals">
                <div class="text-center">
                  <div class="spinner"></div>
                  <p>Carregando metas...</p>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary" onclick="abrirModal('goalModal')">
                <i class="fas fa-plus"></i> Nova Meta
              </button>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Despesas -->
      <section id="expenses-section" class="content-section">
        <div class="section-header">
          <h2>Despesas</h2>
          <div class="section-actions">
            <div class="search-box">
              <input type="text" id="searchExpenses" placeholder="Buscar despesas...">
              <i class="fas fa-search"></i>
            </div>
            <button class="btn btn-primary" onclick="abrirModal('despesaModal')">
              <i class="fas fa-plus"></i> Nova Despesa
            </button>
          </div>
        </div>
        
        <div class="filter-bar">
          <div class="filter-group">
            <label for="expensesDateRange">Período:</label>
            <input type="text" id="expensesDateRange" class="date-range-picker">
          </div>
          <div class="filter-group">
            <label for="expensesCategory">Categoria:</label>
            <select id="expensesCategory">
              <option value="">Todas</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="expensesPaymentType">Pagamento:</label>
            <select id="expensesPaymentType">
              <option value="">Todos</option>
              <option value="avista">À Vista</option>
              <option value="cartao">Cartão</option>
            </select>
          </div>
          <button id="applyExpensesFilter" class="btn btn-primary">Aplicar</button>
          <button id="resetExpensesFilter" class="btn btn-outline">Limpar</button>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="table-container">
              <table id="expensesTable">
                <thead>
                  <tr>
                    <th>Descrição</th>
                    <th>Categoria</th>
                    <th>Valor</th>
                    <th>Data</th>
                    <th>Pagamento</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="expensesTableBody">
                  <tr>
                    <td colspan="7" class="text-center">Carregando despesas...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-footer">
            <div class="pagination">
              <button id="prevPage" class="btn-icon"><i class="fas fa-chevron-left"></i></button>
              <span id="currentPage">Página 1 de 1</span>
              <button id="nextPage" class="btn-icon"><i class="fas fa-chevron-right"></i></button>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Relatórios -->
      <section id="reports-section" class="content-section">
        <div class="section-header">
          <h2>Relatórios</h2>
          <div class="section-actions">
            <div class="filter-group">
              <label for="reportDateRange">Período:</label>
              <input type="text" id="reportDateRange" class="date-range-picker">
            </div>
            <button id="generateReport" class="btn btn-primary">Gerar Relatório</button>
          </div>
        </div>
        
        <div class="grid">
          <div class="card grid-col-2">
            <div class="card-header">
              <div class="card-title">Despesas por Categoria</div>
              <div class="card-actions">
                <button class="btn-icon" id="downloadCategoryChart">
                  <i class="fas fa-download"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <canvas id="reportCategoryChart"></canvas>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">Despesas por Mês</div>
              <div class="card-actions">
                <button class="btn-icon" id="downloadMonthlyChart">
                  <i class="fas fa-download"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <canvas id="monthlyExpensesChart"></canvas>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">Despesas por Forma de Pagamento</div>
              <div class="card-actions">
                <button class="btn-icon" id="downloadPaymentChart">
                  <i class="fas fa-download"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <canvas id="paymentMethodChart"></canvas>
            </div>
          </div>
          
          <div class="card grid-col-2">
            <div class="card-header">
              <div class="card-title">Resumo do Relatório</div>
              <div class="card-actions">
                <button class="btn-icon" id="downloadReportSummary">
                  <i class="fas fa-download"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div id="reportSummary" class="report-summary">
                <div class="text-center">
                  <div class="spinner"></div>
                  <p>Gere um relatório para ver o resumo</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Categorias -->
      <section id="categories-section" class="content-section">
        <div class="section-header">
          <h2>Categorias</h2>
          <div class="section-actions">
            <button class="btn btn-primary" onclick="abrirModal('categoriaModal')">
              <i class="fas fa-plus"></i> Nova Categoria
            </button>
          </div>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div id="categoriasContainer" class="categories-container">
              <div class="text-center">
                <div class="spinner"></div>
                <p>Carregando categorias...</p>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Cartões -->
      <section id="cards-section" class="content-section">
        <div class="section-header">
          <h2>Cartões</h2>
          <div class="section-actions">
            <button class="btn btn-primary" onclick="abrirModal('cartaoModal')">
              <i class="fas fa-plus"></i> Novo Cartão
            </button>
          </div>
        </div>
        
        <div id="cartoesContainer" class="grid">
          <div class="text-center grid-col-2">
            <div class="spinner"></div>
            <p>Carregando cartões...</p>
          </div>
        </div>
      </section>
      
      <!-- Renda -->
      <section id="income-section" class="content-section">
        <div class="section-header">
          <h2>Renda</h2>
          <div class="section-actions">
            <button class="btn btn-primary" onclick="abrirModal('rendaModal')">
              <i class="fas fa-plus"></i> Nova Renda
            </button>
          </div>
        </div>
        
        <div class="grid">
          <div class="card grid-col-2">
            <div class="card-header">
              <div class="card-title">Rendas Cadastradas</div>
            </div>
            <div class="card-body">
              <div id="rendasContainer" class="income-container">
                <div class="text-center">
                  <div class="spinner"></div>
                  <p>Carregando rendas...</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">Renda vs Despesas</div>
            </div>
            <div class="card-body">
              <canvas id="incomeVsExpensesChart"></canvas>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Metas -->
      <section id="goals-section" class="content-section">
        <div class="section-header">
          <h2>Metas Financeiras</h2>
          <div class="section-actions">
            <button class="btn btn-primary" onclick="abrirModal('goalModal')">
              <i class="fas fa-plus"></i> Nova Meta
            </button>
          </div>
        </div>
        
        <div id="goalsContainer" class="grid">
          <div class="text-center grid-col-2">
            <div class="spinner"></div>
            <p>Carregando metas...</p>
          </div>
        </div>
      </section>
      
      <!-- Orçamento -->
      <section id="budget-section" class="content-section">
        <div class="section-header">
          <h2>Orçamento Mensal</h2>
          <div class="section-actions">
            <button class="btn btn-primary" onclick="abrirModal('budgetModal')">
              <i class="fas fa-plus"></i> Novo Orçamento
            </button>
          </div>
        </div>
        
        <div id="budgetContainer" class="grid">
          <div class="text-center grid-col-2">
            <div class="spinner"></div>
            <p>Carregando orçamentos...</p>
          </div>
        </div>
      </section>
      
      <!-- Tendências -->
      <section id="trends-section" class="content-section">
        <div class="section-header">
          <h2>Análise de Tendências</h2>
          <div class="section-actions">
            <button id="refreshTrends" class="btn btn-primary">
              <i class="fas fa-sync-alt"></i> Atualizar
            </button>
          </div>
        </div>
        
        <div id="trendsContainer" class="grid">
          <div class="text-center grid-col-2">
            <div class="spinner"></div>
            <p>Analisando tendências...</p>
          </div>
        </div>
      </section>
      
      <!-- Fluxo de Caixa -->
      <section id="cashflow-section" class="content-section">
        <div class="section-header">
          <h2>Fluxo de Caixa</h2>
          <div class="section-actions">
            <div class="filter-group">
              <label for="cashFlowMonth">Mês:</label>
              <select id="cashFlowMonth">
                <option value="0">Janeiro</option>
                <option value="1">Fevereiro</option>
                <option value="2">Março</option>
                <option value="3">Abril</option>
                <option value="4">Maio</option>
                <option value="5">Junho</option>
                <option value="6">Julho</option>
                <option value="7">Agosto</option>
                <option value="8">Setembro</option>
                <option value="9">Outubro</option>
                <option value="10">Novembro</option>
                <option value="11">Dezembro</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="cashFlowYear">Ano:</label>
              <select id="cashFlowYear">
                <!-- Preenchido via JavaScript -->
              </select>
            </div>
            <button id="loadCashFlow" class="btn btn-primary">Carregar</button>
          </div>
        </div>
        
        <div id="cashFlowContainer" class="grid">
          <div class="text-center grid-col-2">
            <div class="spinner"></div>
            <p>Carregando fluxo de caixa...</p>
          </div>
        </div>
      </section>
      
      <!-- Comparativo -->
      <section id="comparison-section" class="content-section">
        <div class="section-header">
          <h2>Comparativo de Gastos</h2>
          <div class="section-actions">
            <button id="loadComparison" class="btn btn-primary">
              <i class="fas fa-sync-alt"></i> Atualizar
            </button>
          </div>
        </div>
        
        <div id="comparisonContainer" class="grid">
          <div class="text-center grid-col-2">
            <div class="spinner"></div>
            <p>Carregando comparativo...</p>
          </div>
        </div>
      </section>
    </div>
  </main>
  
  <!-- Notificações -->
  <div id="notificationsPanel" class="notifications-panel">
    <div class="notifications-header">
      <h3>Notificações</h3>
      <div class="notifications-actions">
        <button id="notificationSettings" class="btn-icon" title="Configurações">
          <i class="fas fa-cog"></i>
        </button>
        <button id="closeNotifications" class="btn-icon" title="Fechar">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <div id="notificationsContainer" class="notifications-container">
      <div class="text-center">
        <div class="spinner"></div>
        <p>Carregando notificações...</p>
      </div>
    </div>
  </div>
  
  <!-- Overlay -->
  <div id="overlay" class="overlay"></div>
  
  <!-- ===================== MODAIS ===================== -->
  
  <!-- Modal: Nova Despesa -->
  <div id="despesaModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nova Despesa</h2>
        <span class="close" onclick="fecharModal('despesaModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="despesaForm">
          <div class="form-group">
            <input type="text" id="descricao" class="form-control" placeholder=" " required>
            <label for="descricao" class="form-label">Descrição</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="valor" class="form-control" placeholder=" " step="0.01" required>
            <label for="valor" class="form-label">Valor (R$)</label>
          </div>
          
          <div class="form-group">
            <select id="categoria" class="form-control" required>
              <option value="">Selecione uma categoria</option>
            </select>
            <label for="categoria" class="form-label">Categoria</label>
          </div>
          
          <div class="form-group">
            <input type="date" id="dataCompra" class="form-control" required>
            <label for="dataCompra" class="form-label">Data da Compra</label>
          </div>
          
          <div class="form-group">
            <select id="formaPagamento" class="form-control" required>
              <option value="">Selecione a forma de pagamento</option>
              <option value="avista">À Vista</option>
              <option value="cartao">Cartão de Crédito</option>
            </select>
            <label for="formaPagamento" class="form-label">Forma de Pagamento</label>
          </div>
          
          <div id="cartaoOptions" class="form-group" style="display: none;">
            <select id="cartao" class="form-control">
              <option value="">Selecione o cartão</option>
            </select>
            <label for="cartao" class="form-label">Cartão</label>
          </div>
          
          <div id="parcelasOptions" class="form-group" style="display: none;">
            <input type="number" id="parcelas" class="form-control" placeholder=" " min="1" max="24">
            <label for="parcelas" class="form-label">Número de Parcelas</label>
          </div>
          
          <div class="form-group">
            <textarea id="observacao" class="form-control" placeholder=" " rows="3"></textarea>
            <label for="observacao" class="form-label">Observação (opcional)</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('despesaModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="salvarDespesa()">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Editar Despesa -->
  <div id="editarDespesaModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Editar Despesa</h2>
        <span class="close" onclick="fecharModal('editarDespesaModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="editarDespesaForm">
          <input type="hidden" id="editarDespesaId">
          
          <div class="form-group">
            <input type="text" id="editarDescricao" class="form-control" placeholder=" " required>
            <label for="editarDescricao" class="form-label">Descrição</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="editarValor" class="form-control" placeholder=" " step="0.01" required>
            <label for="editarValor" class="form-label">Valor (R$)</label>
          </div>
          
          <div class="form-group">
            <select id="editarCategoria" class="form-control" required>
              <option value="">Selecione uma categoria</option>
            </select>
            <label for="editarCategoria" class="form-label">Categoria</label>
          </div>
          
          <div class="form-group">
            <input type="date" id="editarDataCompra" class="form-control" required>
            <label for="editarDataCompra" class="form-label">Data da Compra</label>
          </div>
          
          <div class="form-group">
            <select id="editarFormaPagamento" class="form-control" required disabled>
              <option value="">Selecione a forma de pagamento</option>
              <option value="avista">À Vista</option>
              <option value="cartao">Cartão de Crédito</option>
            </select>
            <label for="editarFormaPagamento" class="form-label">Forma de Pagamento</label>
            <small class="form-text">A forma de pagamento não pode ser alterada.</small>
          </div>
          
          <div id="editarCartaoOptions" class="form-group" style="display: none;">
            <select id="editarCartao" class="form-control" disabled>
              <option value="">Selecione o cartão</option>
            </select>
            <label for="editarCartao" class="form-label">Cartão</label>
            <small class="form-text">O cartão não pode ser alterado.</small>
          </div>
          
          <div class="form-group">
            <textarea id="editarObservacao" class="form-control" placeholder=" " rows="3"></textarea>
            <label for="editarObservacao" class="form-label">Observação (opcional)</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('editarDespesaModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="atualizarDespesa()">Atualizar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Nova Categoria -->
  <div id="categoriaModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nova Categoria</h2>
        <span class="close" onclick="fecharModal('categoriaModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="categoriaForm">
          <div class="form-group">
            <input type="text" id="categoriaNome" class="form-control" placeholder=" " required>
            <label for="categoriaNome" class="form-label">Nome da Categoria</label>
          </div>
          
          <div class="form-group">
            <div class="color-picker">
              <label>Cor:</label>
              <div class="color-options">
                <div class="color-option" data-color="#4361ee" style="background-color: #4361ee;"></div>
                <div class="color-option" data-color="#3a0ca3" style="background-color: #3a0ca3;"></div>
                <div class="color-option" data-color="#4cc9f0" style="background-color: #4cc9f0;"></div>
                <div class="color-option" data-color="#f72585" style="background-color: #f72585;"></div>
                <div class="color-option" data-color="#7209b7" style="background-color: #7209b7;"></div>
                <div class="color-option" data-color="#4caf50" style="background-color: #4caf50;"></div>
                <div class="color-option" data-color="#ff9800" style="background-color: #ff9800;"></div>
                <div class="color-option" data-color="#e63946" style="background-color: #e63946;"></div>
              </div>
              <input type="hidden" id="categoriaCor" value="#4361ee">
            </div>
          </div>
          
          <div class="form-group">
            <div class="icon-picker">
              <label>Ícone:</label>
              <div class="icon-options">
                <div class="icon-option" data-icon="fa-shopping-cart"><i class="fas fa-shopping-cart"></i></div>
                <div class="icon-option" data-icon="fa-home"><i class="fas fa-home"></i></div>
                <div class="icon-option" data-icon="fa-car"><i class="fas fa-car"></i></div>
                <div class="icon-option" data-icon="fa-utensils"><i class="fas fa-utensils"></i></div>
                <div class="icon-option" data-icon="fa-plane"><i class="fas fa-plane"></i></div>
                <div class="icon-option" data-icon="fa-tshirt"><i class="fas fa-tshirt"></i></div>
                <div class="icon-option" data-icon="fa-graduation-cap"><i class="fas fa-graduation-cap"></i></div>
                <div class="icon-option" data-icon="fa-heartbeat"><i class="fas fa-heartbeat"></i></div>
              </div>
              <input type="hidden" id="categoriaIcone" value="fa-shopping-cart">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('categoriaModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="salvarCategoria()">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Novo Cartão -->
  <div id="cartaoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Novo Cartão</h2>
        <span class="close" onclick="fecharModal('cartaoModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="cartaoForm">
          <div class="form-group">
            <input type="text" id="nomeCartao" class="form-control" placeholder=" " required>
            <label for="nomeCartao" class="form-label">Nome do Cartão</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="diaFatura" class="form-control" placeholder=" " min="1" max="31" required>
            <label for="diaFatura" class="form-label">Dia da Fatura</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="diaFechamento" class="form-control" placeholder=" " min="1" max="31" required>
            <label for="diaFechamento" class="form-label">Dia do Fechamento</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="limiteCartao" class="form-control" placeholder=" " step="0.01">
            <label for="limiteCartao" class="form-label">Limite do Cartão (R$)</label>
          </div>
          
          <div class="form-group">
            <div class="color-picker">
              <label>Cor:</label>
              <div class="color-options">
                <div class="color-option" data-color="#4361ee" style="background-color: #4361ee;"></div>
                <div class="color-option" data-color="#3a0ca3" style="background-color: #3a0ca3;"></div>
                <div class="color-option" data-color="#4cc9f0" style="background-color: #4cc9f0;"></div>
                <div class="color-option" data-color="#f72585" style="background-color: #f72585;"></div>
                <div class="color-option" data-color="#7209b7" style="background-color: #7209b7;"></div>
                <div class="color-option" data-color="#4caf50" style="background-color: #4caf50;"></div>
                <div class="color-option" data-color="#ff9800" style="background-color: #ff9800;"></div>
                <div class="color-option" data-color="#e63946" style="background-color: #e63946;"></div>
              </div>
              <input type="hidden" id="cartaoCor" value="#4361ee">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('cartaoModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="salvarCartao()">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Nova Renda -->
  <div id="rendaModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nova Renda</h2>
        <span class="close" onclick="fecharModal('rendaModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="rendaForm">
          <div class="form-group">
            <input type="text" id="rendaDescricao" class="form-control" placeholder=" " required>
            <label for="rendaDescricao" class="form-label">Descrição</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="rendaValor" class="form-control" placeholder=" " step="0.01" required>
            <label for="rendaValor" class="form-label">Valor (R$)</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="rendaDia" class="form-control" placeholder=" " min="1" max="31" required>
            <label for="rendaDia" class="form-label">Dia do Recebimento</label>
          </div>
          
          <div class="form-group">
            <select id="rendaTipo" class="form-control" required>
              <option value="">Selecione o tipo</option>
              <option value="salario">Salário</option>
              <option value="freelance">Freelance</option>
              <option value="investimento">Investimento</option>
              <option value="aluguel">Aluguel</option>
              <option value="outro">Outro</option>
            </select>
            <label for="rendaTipo" class="form-label">Tipo de Renda</label>
          </div>
          
          <div class="form-group">
            <textarea id="rendaObservacao" class="form-control" placeholder=" " rows="3"></textarea>
            <label for="rendaObservacao" class="form-label">Observação (opcional)</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('rendaModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="salvarRenda()">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Nova Meta -->
  <div id="goalModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nova Meta Financeira</h2>
        <span class="close" onclick="fecharModal('goalModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="goalForm">
          <div class="form-group">
            <input type="text" id="goalName" class="form-control" placeholder=" " required>
            <label for="goalName" class="form-label">Nome da Meta</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="goalAmount" class="form-control" placeholder=" " step="0.01" required>
            <label for="goalAmount" class="form-label">Valor da Meta (R$)</label>
          </div>
          
          <div class="form-group">
            <input type="date" id="goalDate" class="form-control" required>
            <label for="goalDate" class="form-label">Data Limite</label>
          </div>
          
          <div class="form-group">
            <select id="goalCategory" class="form-control">
              <option value="">Selecione uma categoria (opcional)</option>
              <option value="viagem">Viagem</option>
              <option value="carro">Carro</option>
              <option value="casa">Casa</option>
              <option value="educacao">Educação</option>
              <option value="aposentadoria">Aposentadoria</option>
              <option value="emergencia">Fundo de Emergência</option>
              <option value="outro">Outro</option>
            </select>
            <label for="goalCategory" class="form-label">Categoria</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="goalInitialAmount" class="form-control" placeholder=" " step="0.01">
            <label for="goalInitialAmount" class="form-label">Valor Inicial (R$)</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('goalModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="saveFinancialGoal()">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Editar Meta -->
  <div id="editGoalModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Editar Meta Financeira</h2>
        <span class="close" onclick="fecharModal('editGoalModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="editGoalForm">
          <input type="hidden" id="editGoalId">
          
          <div class="form-group">
            <input type="text" id="editGoalName" class="form-control" placeholder=" " required>
            <label for="editGoalName" class="form-label">Nome da Meta</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="editGoalAmount" class="form-control" placeholder=" " step="0.01" required>
            <label for="editGoalAmount" class="form-label">Valor da Meta (R$)</label>
          </div>
          
          <div class="form-group">
            <input type="date" id="editGoalDate" class="form-control" required>
            <label for="editGoalDate" class="form-label">Data Limite</label>
          </div>
          
          <div class="form-group">
            <select id="editGoalCategory" class="form-control">
              <option value="">Selecione uma categoria (opcional)</option>
              <option value="viagem">Viagem</option>
              <option value="carro">Carro</option>
              <option value="casa">Casa</option>
              <option value="educacao">Educação</option>
              <option value="aposentadoria">Aposentadoria</option>
              <option value="emergencia">Fundo de Emergência</option>
              <option value="outro">Outro</option>
            </select>
            <label for="editGoalCategory" class="form-label">Categoria</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('editGoalModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="updateGoal()">Atualizar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Adicionar Contribuição -->
  <div id="contributionModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Adicionar Contribuição</h2>
        <span class="close" onclick="fecharModal('contributionModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="contributionForm">
          <input type="hidden" id="contributionGoalId">
          
          <div class="form-group">
            <div class="contribution-info">
              <div class="contribution-goal-name" id="contributionGoalName">Nome da Meta</div>
              <div class="contribution-amounts">
                <div>Atual: <span id="contributionCurrentAmount">R$ 0,00</span></div>
                <div>Meta: <span id="contributionTargetAmount">R$ 0,00</span></div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <input type="number" id="contributionAmount" class="form-control" placeholder=" " step="0.01" required>
            <label for="contributionAmount" class="form-label">Valor da Contribuição (R$)</label>
          </div>
          
          <div class="form-group">
            <input type="text" id="contributionDescription" class="form-control" placeholder=" ">
            <label for="contributionDescription" class="form-label">Descrição (opcional)</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('contributionModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="saveContribution()">Adicionar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Novo Orçamento -->
  <div id="budgetModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Novo Orçamento</h2>
        <span class="close" onclick="fecharModal('budgetModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="budgetForm">
          <div class="form-group">
            <select id="budgetCategory" class="form-control" required>
              <option value="">Selecione uma categoria</option>
            </select>
            <label for="budgetCategory" class="form-label">Categoria</label>
          </div>
          
          <div class="form-group">
            <input type="number" id="budgetLimit" class="form-control" placeholder=" " step="0.01" required>
            <label for="budgetLimit" class="form-label">Limite Mensal (R$)</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('budgetModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="saveBudget()">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Editar Orçamento -->
  <div id="editBudgetModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Editar Orçamento</h2>
        <span class="close" onclick="fecharModal('editBudgetModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="editBudgetForm">
          <input type="hidden" id="editBudgetCategoryId">
          
          <div class="form-group">
            <div class="budget-category-name" id="editBudgetCategory">Nome da Categoria</div>
          </div>
          
          <div class="form-group">
            <input type="number" id="editBudgetLimit" class="form-control" placeholder=" " step="0.01" required>
            <label for="editBudgetLimit" class="form-label">Limite Mensal (R$)</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('editBudgetModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="updateBudget()">Atualizar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal: Configurações de Notificações -->
  <div id="notificationSettingsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Configurações de Notificações</h2>
        <span class="close" onclick="fecharModal('notificationSettingsModal')">&times;</span>
      </div>
      <div class="modal-body">
        <form id="notificationSettingsForm">
          <div class="form-check">
            <input type="checkbox" id="notifyBudget" class="form-check-input" checked>
            <label for="notifyBudget" class="form-check-label">Notificar quando orçamentos estiverem próximos do limite</label>
          </div>
          
          <div class="form-check">
            <input type="checkbox" id="notifyDueDate" class="form-check-input" checked>
            <label for="notifyDueDate" class="form-check-label">Notificar sobre vencimentos próximos</label>
          </div>
          
          <div class="form-check">
            <input type="checkbox" id="notifyOverdue" class="form-check-input" checked>
            <label for="notifyOverdue" class="form-check-label">Notificar sobre despesas vencidas</label>
          </div>
          
          <div class="form-check">
            <input type="checkbox" id="notifyGoals" class="form-check-input" checked>
            <label for="notifyGoals" class="form-check-label">Notificar sobre metas próximas do prazo</label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('notificationSettingsModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="saveNotificationSettings()">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- ===================== SCRIPTS ===================== -->
  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-database-compat.js"></script>
  
  <script>
    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAG6LktPXGe6F-vSTHV2Y3n95vSwhpXch8",
      authDomain: "controlegasto-df3f1.firebaseapp.com",
      databaseURL: "https://controlegasto-df3f1-default-rtdb.firebaseio.com",
      projectId: "controlegasto-df3f1",
      storageBucket: "controlegasto-df3f1.firebasestorage.app",
      messagingSenderId: "1034936676414",
      appId: "1:1034936676414:web:61c67ce39c3ab71a07a16f",
      measurementId: "G-PTN43GZHGR"
    };
    
    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    
    // Verificar autenticação
    auth.onAuthStateChanged(user => {
      if (user) {
        // Usuário está logado
        updateUserInfo(user);
        initializeApp();
        document.getElementById('loading-screen').style.display = 'none';
      } else {
        // Usuário não está logado, redirecionar para página de login
        window.location.href = 'login_system.html';
      }
    });
    
    // Atualizar informações do usuário
    function updateUserInfo(user) {
      const userName = document.getElementById('userName');
      const userEmail = document.getElementById('userEmail');
      const userNameSmall = document.getElementById('userNameSmall');
      const userAvatar = document.getElementById('userAvatar');
      const userAvatarSmall = document.getElementById('userAvatarSmall');
      
      userName.textContent = user.displayName || 'Usuário';
      userEmail.textContent = user.email;
      userNameSmall.textContent = user.displayName || 'Usuário';
      
      if (user.photoURL) {
        userAvatar.src = user.photoURL;
        userAvatarSmall.src = user.photoURL;
      }
    }
    
    // Inicializar aplicativo
    function initializeApp() {
      // Configurar navegação
      setupNavigation();
      
      // Configurar tema
      setupTheme();
      
      // Configurar eventos
      setupEvents();
      
      // Carregar dados iniciais
      loadInitialData();
      
      // Verificar notificações
      checkAllNotifications();
    }
    
    // Configurar navegação
    function setupNavigation() {
      // Navegação do sidebar
      const navLinks = document.querySelectorAll('.sidebar-nav a, #bottom-nav a, .more-menu-content a');
      
      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          if (this.getAttribute('href').startsWith('#')) {
            e.preventDefault();
            
            const section = this.getAttribute('href').substring(1);
            
            if (section) {
              // Atualizar navegação ativa
              document.querySelectorAll('.sidebar-nav li, #bottom-nav a').forEach(item => {
                item.classList.remove('active');
              });
              
              document.querySelectorAll(`[data-section="${section}"]`).forEach(item => {
                item.classList.add('active');
              });
              
              // Mostrar seção correspondente
              document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
              });
              
              const targetSection = document.getElementById(`${section}-section`);
              if (targetSection) {
                targetSection.classList.add('active');
                document.getElementById('pageTitle').textContent = targetSection.querySelector('h2').textContent;
              }
              
              // Fechar menu mais em dispositivos móveis
              document.getElementById('moreMenu').classList.remove('active');
              document.getElementById('overlay').classList.remove('active');
            }
          }
        });
      });
      
      // Toggle do sidebar
      document.getElementById('toggleSidebar').addEventListener('click', function() {
        document.getElementById('sidebar').classList.toggle('collapsed');
        document.querySelector('main').classList.toggle('expanded');
      });
      
      // Toggle do sidebar em dispositivos móveis
      document.getElementById('mobileSidebarToggle').addEventListener('click', function() {
        document.getElementById('sidebar').classList.toggle('active');
        document.getElementById('overlay').classList.toggle('active');
      });
      
      // Menu mais em dispositivos móveis
      document.getElementById('moreBtn').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('moreMenu').classList.add('active');
        document.getElementById('overlay').classList.add('active');
      });
      
      document.getElementById('closeMoreMenu').addEventListener('click', function() {
        document.getElementById('moreMenu').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
      });
      
      // Overlay
      document.getElementById('overlay').addEventListener('click', function() {
        document.getElementById('sidebar').classList.remove('active');
        document.getElementById('moreMenu').classList.remove('active');
        document.getElementById('notificationsPanel').classList.remove('active');
        this.classList.remove('active');
      });
      
      // Dropdown do usuário
      document.getElementById('userDropdownBtn').addEventListener('click', function() {
        document.getElementById('userDropdownMenu').classList.toggle('active');
      });
      
      // Fechar dropdown ao clicar fora
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.user-dropdown') && document.getElementById('userDropdownMenu').classList.contains('active')) {
          document.getElementById('userDropdownMenu').classList.remove('active');
        }
      });
      
      // Notificações
      document.getElementById('notificationsBtn').addEventListener('click', function() {
        document.getElementById('notificationsPanel').classList.toggle('active');
        document.getElementById('overlay').classList.toggle('active');
        loadNotifications();
      });
      
      document.getElementById('closeNotifications').addEventListener('click', function() {
        document.getElementById('notificationsPanel').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
      });
      
      document.getElementById('notificationSettings').addEventListener('click', function() {
        abrirModal('notificationSettingsModal');
      });
    }
    
    // Configurar tema
    function setupTheme() {
      const themeToggle = document.getElementById('themeToggle');
      const mobileThemeToggle = document.getElementById('mobileThemeToggle');
      
      // Carregar tema salvo
      const savedTheme = localStorage.getItem('theme');
      
      if (savedTheme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i> <span>Tema Claro</span>';
        mobileThemeToggle.innerHTML = '<i class="fas fa-sun"></i> Tema Claro';
      }
      
      // Toggle do tema
      themeToggle.addEventListener('click', function() {
        toggleTheme();
      });
      
      mobileThemeToggle.addEventListener('click', function() {
        toggleTheme();
        document.getElementById('moreMenu').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
      });
      
      function toggleTheme() {
        if (document.documentElement.getAttribute('data-theme') === 'dark') {
          document.documentElement.removeAttribute('data-theme');
          themeToggle.innerHTML = '<i class="fas fa-moon"></i> <span>Tema Escuro</span>';
          mobileThemeToggle.innerHTML = '<i class="fas fa-moon"></i> Tema Escuro';
          localStorage.setItem('theme', 'light');
        } else {
          document.documentElement.setAttribute('data-theme', 'dark');
          themeToggle.innerHTML = '<i class="fas fa-sun"></i> <span>Tema Claro</span>';
          mobileThemeToggle.innerHTML = '<i class="fas fa-sun"></i> Tema Claro';
          localStorage.setItem('theme', 'dark');
        }
      }
    }
    
    // Configurar eventos
    function setupEvents() {
      // Logout
      const logoutButtons = document.querySelectorAll('#logoutBtn, #headerLogoutBtn, #mobileLogout');
      
      logoutButtons.forEach(button => {
        button.addEventListener('click', function() {
          auth.signOut().then(() => {
            window.location.href = 'login_system.html';
          }).catch(error => {
            console.error('Erro ao fazer logout:', error);
          });
        });
      });
      
      // Exportar dados
      document.getElementById('exportDataBtn').addEventListener('click', function() {
        exportData();
        document.getElementById('userDropdownMenu').classList.remove('active');
      });
      
      // Formulário de despesa
      document.getElementById('formaPagamento').addEventListener('change', function() {
        const cartaoOptions = document.getElementById('cartaoOptions');
        const parcelasOptions = document.getElementById('parcelasOptions');
        
        if (this.value === 'cartao') {
          cartaoOptions.style.display = 'block';
          parcelasOptions.style.display = 'block';
        } else {
          cartaoOptions.style.display = 'none';
          parcelasOptions.style.display = 'none';
        }
      });
      
      // Seletor de cores
      document.querySelectorAll('.color-option').forEach(option => {
        option.addEventListener('click', function() {
          const color = this.getAttribute('data-color');
          const input = this.closest('.color-picker').querySelector('input[type="hidden"]');
          
          // Remover seleção anterior
          this.closest('.color-options').querySelectorAll('.color-option').forEach(opt => {
            opt.classList.remove('selected');
          });
          
          // Adicionar seleção atual
          this.classList.add('selected');
          
          // Atualizar valor
          input.value = color;
        });
      });
      
      // Seletor de ícones
      document.querySelectorAll('.icon-option').forEach(option => {
        option.addEventListener('click', function() {
          const icon = this.getAttribute('data-icon');
          const input = this.closest('.icon-picker').querySelector('input[type="hidden"]');
          
          // Remover seleção anterior
          this.closest('.icon-options').querySelectorAll('.icon-option').forEach(opt => {
            opt.classList.remove('selected');
          });
          
          // Adicionar seleção atual
          this.classList.add('selected');
          
          // Atualizar valor
          input.value = icon;
        });
      });
      
      // Inicializar seletores de data
      $('#expensesDateRange, #reportDateRange').daterangepicker({
        opens: 'left',
        locale: {
          format: 'DD/MM/YYYY',
          applyLabel: 'Aplicar',
          cancelLabel: 'Cancelar',
          fromLabel: 'De',
          toLabel: 'Até',
          customRangeLabel: 'Personalizado',
          daysOfWeek: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],
          monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
          firstDay: 1
        },
        ranges: {
          'Hoje': [moment(), moment()],
          'Ontem': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
          'Últimos 7 Dias': [moment().subtract(6, 'days'), moment()],
          'Últimos 30 Dias': [moment().subtract(29, 'days'), moment()],
          'Este Mês': [moment().startOf('month'), moment().endOf('month')],
          'Mês Passado': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
        }
      });
      
      // Inicializar máscaras
      $('#valor, #editarValor, #rendaValor, #limiteCartao, #goalAmount, #editGoalAmount, #goalInitialAmount, #contributionAmount, #budgetLimit, #editBudgetLimit').mask('000.000.000.000.000,00', {reverse: true});
      
      // Inicializar anos para fluxo de caixa
      const cashFlowYear = document.getElementById('cashFlowYear');
      const currentYear = new Date().getFullYear();
      
      for (let i = currentYear - 2; i <= currentYear + 2; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        
        if (i === currentYear) {
          option.selected = true;
        }
        
        cashFlowYear.appendChild(option);
      }
      
      // Inicializar mês atual para fluxo de caixa
      document.getElementById('cashFlowMonth').value = new Date().getMonth();
      
      // Botão de carregar fluxo de caixa
      document.getElementById('loadCashFlow').addEventListener('click', function() {
        loadCashFlow();
      });
      
      // Botão de carregar comparativo
      document.getElementById('loadComparison').addEventListener('click', function() {
        loadExpenseComparison();
      });
      
      // Botão de atualizar tendências
      document.getElementById('refreshTrends').addEventListener('click', function() {
        loadTrendsAnalysis();
      });
    }
    
    // Carregar dados iniciais
    function loadInitialData() {
      // Carregar dados do dashboard
      loadDashboardData();
      
      // Carregar categorias
      loadCategorias();
      
      // Carregar cartões
      loadCartoes();
      
      // Inicializar seletores de data com mês atual
      const today = new Date();
      const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
      const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
      
      $('#expensesDateRange, #reportDateRange').data('daterangepicker').setStartDate(startOfMonth);
      $('#expensesDateRange, #reportDateRange').data('daterangepicker').setEndDate(endOfMonth);
      
      // Atualizar mês atual no dashboard
      updateCurrentMonth();
    }
    
    // Carregar dados do dashboard
    function loadDashboardData() {
      // Carregar resumo financeiro
      loadFinancialSummary();
      
      // Carregar gráfico de categorias
      loadCategoryChart();
      
      // Carregar despesas recentes
      loadRecentExpenses();
      
      // Carregar próximos vencimentos
      loadUpcomingDues();
      
      // Carregar metas no dashboard
      loadDashboardGoals();
    }
    
    // Carregar resumo financeiro
    function loadFinancialSummary() {
      // Implementação existente
    }
    
    // Carregar gráfico de categorias
    function loadCategoryChart() {
      // Implementação existente
    }
    
    // Carregar despesas recentes
    function loadRecentExpenses() {
      // Implementação existente
    }
    
    // Carregar próximos vencimentos
    function loadUpcomingDues() {
      // Implementação existente
    }
    
    // Carregar metas no dashboard
    function loadDashboardGoals() {
      const userId = auth.currentUser.uid;
      const dashboardGoals = document.getElementById('dashboardGoals');
      
      dashboardGoals.innerHTML = '<div class="text-center"><div class="spinner"></div><p>Carregando metas...</p></div>';
      
      db.ref(`users/${userId}/goals`).limitToFirst(3).once('value').then(snapshot => {
        if (!snapshot.exists()) {
          dashboardGoals.innerHTML = '<div class="text-center"><p>Você ainda não tem metas cadastradas.</p><button class="btn btn-sm btn-primary mt-2" onclick="abrirModal(\'goalModal\')"><i class="fas fa-plus"></i> Criar Meta</button></div>';
          return;
        }
        
        dashboardGoals.innerHTML = '';
        
        snapshot.forEach(childSnapshot => {
          const goal = childSnapshot.val();
          const goalId = childSnapshot.key;
          const progress = calculateGoalProgress(goal);
          
          let statusClass = 'primary';
          if (progress >= 100) {
            statusClass = 'success';
          } else if (isGoalNearDeadline(goal)) {
            statusClass = 'warning';
          }
          
          const daysLeft = calculateDaysLeft(goal.targetDate);
          const daysLeftText = daysLeft > 0 
            ? `${daysLeft} dias restantes` 
            : daysLeft === 0 
              ? 'Vence hoje!' 
              : `Venceu há ${Math.abs(daysLeft)} dias`;
          
          const goalItem = document.createElement('div');
          goalItem.className = 'dashboard-goal-item';
          goalItem.innerHTML = `
            <div class="dashboard-goal-header">
              <div class="dashboard-goal-title">${goal.name}</div>
              <div class="dashboard-goal-amount">R$ ${parseFloat(goal.currentAmount).toFixed(2)} / R$ ${parseFloat(goal.targetAmount).toFixed(2)}</div>
            </div>
            <div class="progress">
              <div class="progress-bar progress-bar-${statusClass}" style="width: ${progress}%"></div>
            </div>
            <div class="dashboard-goal-footer">
              <div>${progress}% concluído</div>
              <div class="text-${statusClass === 'warning' ? 'warning' : statusClass === 'success' ? 'success' : 'secondary'}">${daysLeftText}</div>
            </div>
          `;
          
          dashboardGoals.appendChild(goalItem);
        });
        
        // Adicionar link para ver todas
        const viewAllLink = document.createElement('div');
        viewAllLink.className = 'text-center mt-3';
        viewAllLink.innerHTML = '<a href="#goals" class="btn btn-sm btn-outline">Ver Todas</a>';
        
        dashboardGoals.appendChild(viewAllLink);
      }).catch(error => {
        console.error('Erro ao carregar metas:', error);
        dashboardGoals.innerHTML = '<div class="text-center"><p>Erro ao carregar metas. Tente novamente.</p></div>';
      });
    }
    
    // Carregar categorias
    function loadCategorias() {
      // Implementação existente
    }
    
    // Carregar cartões
    function loadCartoes() {
      // Implementação existente
    }
    
    // Atualizar mês atual no dashboard
    function updateCurrentMonth() {
      const months = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
      const currentDate = new Date();
      const currentMonthElement = document.getElementById('currentMonth');
      
      currentMonthElement.textContent = `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
    }
    
    // Abrir modal
    function abrirModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.style.display = 'flex';
      document.getElementById('overlay').classList.add('active');
      
      // Inicializar campos específicos
      if (modalId === 'budgetModal') {
        loadCategoriesForBudget();
      }
    }
    
    // Fechar modal
    function fecharModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.style.display = 'none';
      document.getElementById('overlay').classList.remove('active');
    }
    
    // Funções existentes
    function salvarDespesa() {
      // Implementação existente
    }
    
    function atualizarDespesa() {
      // Implementação existente
    }
    
    function salvarCategoria() {
      // Implementação existente
    }
    
    function salvarCartao() {
      // Implementação existente
    }
    
    function salvarRenda() {
      // Implementação existente
    }
  </script>
  
  <!-- Novas Funcionalidades -->
  <script src="js/financial_features.js"></script>
</body>
</html>
