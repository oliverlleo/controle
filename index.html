<!DOCTYPE html> 
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gerenciamento de Contas Pessoais</title>
  
  <!-- força o redirecionamento para a página de detecção antes de carregar o resto -->
  <script>
    // Se já estiver autenticado, a lógica do redirect.html manda para mobile.html ou index.html
    window.location.replace('redirect.html?to=');
  </script>

  <!-- Meta tags para evitar cache -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
  <!-- Google Fonts: Roboto -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- CSS do Daterangepicker -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css?v=1.0.0" />
  
  <!-- ApexCharts para gráficos interativos -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  
  <!-- Toastify para notificações -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  
  <!-- Ícones (Font Awesome) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css?v=1.0.0">
  
  <!-- CSS unificado -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/inteligencia_financeira.css">
  
  <!-- CSS Mobile -->
  <link rel="stylesheet" href="css/mobile.css">
</head>
<body>
  <!-- Botão de menu para dispositivos móveis -->
  <button class="menu-toggle" id="menuToggle">
    <i class="fas fa-bars"></i>
  </button>
  
  <div class="app-container">
    <!-- Menu Lateral -->
    <aside id="sidebar">
      <h2><i class="fa-solid fa-wallet"></i> Contas</h2>
      <!-- Informações do usuário serão inseridas aqui pelo auth.js -->
      <div id="sidebar-nav">
        <a href="#" class="nav-link active" onclick="showSection('dashboardSection')">
          <i class="fa-solid fa-house"></i>
          <span>Dashboard</span>
        </a>
        <a href="#" class="nav-link" onclick="showSection('despesasSection')">
          <i class="fa-solid fa-money-bill-wave"></i>
          <span>Despesas</span>
        </a>
        <a href="#" class="nav-link" onclick="showSection('relatorioIntegradoSection')">
          <i class="fa-solid fa-chart-line"></i>
          <span>Relatórios & Previsões</span>
        </a>
        <a href="#" class="nav-link" onclick="showSection('inteligenciaFinanceiraSection')">
          <i class="fa-solid fa-brain"></i>
          <span>Inteligência Financeira</span>
        </a>
        <a href="#" class="nav-link" onclick="showSection('metasFinanceirasSection')">
          <i class="fa-solid fa-bullseye"></i>
          <span>Metas</span>
        </a>
        <a href="#" class="nav-link" onclick="showSection('configuracoesSection')">
          <i class="fa-solid fa-cog"></i>
          <span>Configurações</span>
        </a>
        <a href="#" class="nav-link" onclick="exportData()">
          <i class="fa-solid fa-file-export"></i>
          <span>Exportar</span>
        </a>
        <a href="#" class="nav-link" onclick="showSection('alertasSection')">
          <i class="fa-solid fa-bell"></i>
          <span>Alertas</span>
        </a>
        <!-- Botão de logout será inserido aqui pelo auth.js -->
      </div>
    </aside>
    
    <!-- Conteúdo Principal -->
    <main>
      <header>
        <h1>Sistema de Gerenciamento de Contas</h1>
      </header>
      
      <!-- Dashboard Resumido -->
      <section id="dashboardSection" class="container">
        <div class="chart-header">
          <h2>Dashboard Resumido</h2>
          <div id="dashboardMonthSelector" class="d-flex align-center gap-2 flex-wrap">
            <div class="form-group mb-0">
              <select id="dashboardMonth" class="form-control">
                <option value="0">Janeiro</option>
                <option value="1">Fevereiro</option>
                <option value="2">Março</option>
                <option value="3">Abril</option>
                <option value="4">Maio</option>
                <option value="5">Junho</option>
                <option value="6">Julho</option>
                <option value="7">Agosto</option>
                <option value="8">Setembro</option>
                <option value="9">Outubro</option>
                <option value="10">Novembro</option>
                <option value="11">Dezembro</option>
              </select>
            </div>
            <div class="form-group mb-0">
              <select id="dashboardYear" class="form-control">
                <option value="2020">2020</option>
                <option value="2021">2021</option>
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <option value="2024">2024</option>
                <option value="2025">2025</option>
                <option value="2026">2026</option>
                <option value="2027">2027</option>
                <option value="2028">2028</option>
                <option value="2029">2029</option>
                <option value="2030">2030</option>
              </select>
            </div>
            <button class="btn btn-primary" onclick="atualizarDashboard()">
              <i class="fas fa-sync-alt"></i>
              <span>Atualizar</span>
            </button>
          </div>
        </div>
        
        <div class="dashboard-cards">
          <div class="dashboard-card">
            <div class="dashboard-card-header">
              <div class="dashboard-card-title">Saldo Atual</div>
              <div class="dashboard-card-icon">
                <i class="fas fa-wallet"></i>
              </div>
            </div>
            <div class="dashboard-card-value" id="saldoAtual">R$ 6416.60</div>
            <div class="dashboard-card-label">Disponível para uso</div>
          </div>
          
          <div class="dashboard-card">
            <div class="dashboard-card-header">
              <div class="dashboard-card-title">Despesas do Mês</div>
              <div class="d-flex gap-1">
                <button class="btn-icon" onclick="prevDashboardMonth()">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <button class="btn-icon" onclick="nextDashboardMonth()">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
            <div class="dashboard-card-value" id="despesasMes">R$ 4440.00</div>
            <div class="dashboard-card-label" id="despesasMesTitle">Março de 2025</div>
          </div>
          
          <div class="dashboard-card">
            <div class="dashboard-card-header">
              <div class="dashboard-card-title">Próximos Vencimentos</div>
              <div class="dashboard-card-icon">
                <i class="fas fa-calendar-alt"></i>
              </div>
            </div>
            <div class="dashboard-card-value" id="proximosVencimentos">27</div>
            <div class="dashboard-card-label">Dias até o próximo vencimento</div>
          </div>
        </div>
        
        <div class="chart-container">
          <div class="chart-header">
            <h3 class="chart-title">Análise de Despesas</h3>
          </div>
          <div class="grafico-painel-container">
            <div class="chart-panel" style="flex: 3;">
              <div id="graficoDespesas"></div>
            </div>
            <div class="chart-panel" style="flex: 2;">
              <h4 class="mb-2">Despesas do Mês</h4>
              <div id="listaDespesasMes" class="despesas-lista"></div>
            </div>
          </div>
        </div>
        
        <button class="btn btn-primary btn-block" onclick="abrirModal('cadastroDespesaModal')">
          <i class="fas fa-plus"></i>
          <span>Cadastrar Nova Despesa</span>
        </button>
      </section>
      
      <!-- (o resto do seu HTML continua **sem nenhuma alteração**) -->
      
    </main>
  </div>
  
  <!-- ===================== MODAIS ===================== -->
  <!-- todos os seus modais aqui, sem alteração -->
  
  <!-- Scripts externos e do seu app -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <script src="js/script.js"></script>
  <script src="js/inteligencia_financeira.js"></script>
  
  <script>
    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
      // Configurar data atual para campos de data
      const hoje = new Date();
      const dataFormatada = hoje.toISOString().split('T')[0];
      
      const dataCompraInput = document.getElementById('dataCompra');
      if (dataCompraInput) dataCompraInput.value = dataFormatada;
      
      const dataPagamentoInput = document.getElementById('dataPagamento');
      if (dataPagamentoInput) dataPagamentoInput.value = dataFormatada;
      
      // Configurar mês atual no dashboard
      const dashboardMonth = document.getElementById('dashboardMonth');
      if (dashboardMonth) dashboardMonth.value = hoje.getMonth();
      
      const dashboardYear = document.getElementById('dashboardYear');
      if (dashboardYear) dashboardYear.value = hoje.getFullYear();
      
      // Inicializar DateRangePicker
      initDateRangePicker();
      
      // Verificar autenticação
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          currentUser = user;
          carregarDadosUsuario();
        } else {
          // redireciona para o redirect.html, que vai enviar para login.html ou mobile-login.html
          window.location.href = 'redirect.html?to=login';
        }
      });
      
      // Resto da sua inicialização (showRelatorioTab, showSection, etc)
      …
    });
  </script>
  
  <!-- Script Mobile -->
  <script src="js/mobile.js"></script>
</body>
</html>
