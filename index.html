<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gerenciamento de Contas Pessoais</title>
  
  <!-- Meta tags para evitar cache -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
  <!-- Google Fonts: Roboto -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- CSS do Daterangepicker -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css?v=1.0.0" />
  
  <!-- ApexCharts para gráficos interativos -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  
  <!-- Toastify para notificações -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  
  <!-- Ícones (Font Awesome) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css?v=1.0.0">
  
  <!-- CSS personalizado -->
  <link rel="stylesheet" href="css/redesigned.css">
  <link rel="stylesheet" href="css/auth.css">
</head>
<body>
  <!-- Botão de menu para dispositivos móveis -->
  <button class="menu-toggle" id="menuToggle">
    <i class="fas fa-bars"></i>
  </button>
  
  <div class="app-container">
    <!-- Menu Lateral -->
    <aside id="sidebar">
      <h2><i class="fa-solid fa-wallet"></i> Contas</h2>
      <!-- Informações do usuário serão inseridas aqui pelo auth.js -->
      <a href="#" class="nav-link active" onclick="activateTab('dashboard-tab')">
        <i class="fa-solid fa-house"></i>
        <span>Dashboard</span>
      </a>
      <a href="#" class="nav-link" onclick="activateTab('despesas-tab')">
        <i class="fa-solid fa-money-bill-wave"></i>
        <span>Despesas</span>
      </a>
      <a href="#" class="nav-link" onclick="activateTab('relatorio-tab')">
        <i class="fa-solid fa-chart-line"></i>
        <span>Relatórios</span>
      </a>
      <a href="#" class="nav-link" onclick="activateTab('previsao-tab')">
        <i class="fa-solid fa-chart-pie"></i>
        <span>Previsões</span>
      </a>
      <a href="#" class="nav-link" onclick="activateTab('calendario-tab')">
        <i class="fa-solid fa-calendar-alt"></i>
        <span>Calendário</span>
      </a>
      <a href="#" class="nav-link" onclick="activateTab('categorias-tab')">
        <i class="fa-solid fa-tags"></i>
        <span>Categorias</span>
      </a>
      <a href="#" class="nav-link" onclick="activateTab('cartoes-tab')">
        <i class="fa-solid fa-credit-card"></i>
        <span>Cartões</span>
      </a>
      <a href="#" class="nav-link" onclick="activateTab('renda-tab')">
        <i class="fa-solid fa-user"></i>
        <span>Renda</span>
      </a>
      <a href="#" class="nav-link" onclick="exportData()">
        <i class="fa-solid fa-file-export"></i>
        <span>Exportar Dados</span>
      </a>
      <!-- Botão de logout será inserido aqui pelo auth.js -->
    </aside>
    
    <!-- Conteúdo Principal -->
    <main>
      <header>
        <h1>Sistema de Gerenciamento de Contas</h1>
        
        <!-- Seletor de Mês/Ano Global -->
        <div class="chart-container mb-4">
          <div class="chart-header">
            <h3 class="chart-title">Período de Análise</h3>
            <div id="dashboardMonthSelector" class="d-flex align-center gap-2 flex-wrap">
              <div class="form-group mb-0">
                <select id="dashboardMonth" class="form-control">
                  <option value="0">Janeiro</option>
                  <option value="1">Fevereiro</option>
                  <option value="2">Março</option>
                  <option value="3">Abril</option>
                  <option value="4">Maio</option>
                  <option value="5">Junho</option>
                  <option value="6">Julho</option>
                  <option value="7">Agosto</option>
                  <option value="8">Setembro</option>
                  <option value="9">Outubro</option>
                  <option value="10">Novembro</option>
                  <option value="11">Dezembro</option>
                </select>
              </div>
              <div class="form-group mb-0">
                <select id="dashboardYear" class="form-control">
                  <!-- Preenchido dinamicamente -->
                </select>
              </div>
              <button class="btn btn-primary" onclick="atualizarDashboard()">
                <i class="fas fa-sync-alt"></i>
                <span>Atualizar</span>
              </button>
            </div>
          </div>
        </div>
      </header>
      
      <!-- Cards de Resumo Rápido -->
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <div class="dashboard-card-header">
            <div class="dashboard-card-title">Saldo Atual</div>
            <div class="dashboard-card-icon">
              <i class="fas fa-wallet"></i>
            </div>
          </div>
          <div class="dashboard-card-value" id="saldoAtual">R$ 0.00</div>
          <div class="dashboard-card-label">Disponível para uso</div>
        </div>
        
        <div class="dashboard-card">
          <div class="dashboard-card-header">
            <div class="dashboard-card-title">Despesas do Mês</div>
            <div class="d-flex gap-1">
              <button class="btn-icon" onclick="prevDashboardMonth()">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button class="btn-icon" onclick="nextDashboardMonth()">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
          <div class="dashboard-card-value" id="despesasMes">R$ 0.00</div>
          <div class="dashboard-card-label" id="despesasMesTitle">Mês Atual</div>
        </div>
        
        <div class="dashboard-card">
          <div class="dashboard-card-header">
            <div class="dashboard-card-title">Próximos Vencimentos</div>
            <div class="dashboard-card-icon">
              <i class="fas fa-calendar-alt"></i>
            </div>
          </div>
          <div class="dashboard-card-value" id="proximosVencimentos">0</div>
          <div class="dashboard-card-label">Dias até o próximo vencimento</div>
        </div>
      </div>
      
      <!-- Sistema de Abas Principal -->
      <div class="tabs-container">
        <div class="tabs-header">
          <button class="tab-button active" data-tab="dashboard-tab">
            <i class="fas fa-home"></i> Dashboard
          </button>
          <button class="tab-button" data-tab="despesas-tab">
            <i class="fas fa-money-bill-wave"></i> Despesas
          </button>
          <button class="tab-button" data-tab="relatorio-tab">
            <i class="fas fa-chart-line"></i> Relatórios
          </button>
          <button class="tab-button" data-tab="previsao-tab">
            <i class="fas fa-chart-pie"></i> Previsões
          </button>
          <button class="tab-button" data-tab="calendario-tab">
            <i class="fas fa-calendar-alt"></i> Calendário
          </button>
          <button class="tab-button" data-tab="categorias-tab">
            <i class="fas fa-tags"></i> Categorias
          </button>
          <button class="tab-button" data-tab="cartoes-tab">
            <i class="fas fa-credit-card"></i> Cartões
          </button>
          <button class="tab-button" data-tab="renda-tab">
            <i class="fas fa-user"></i> Renda
          </button>
        </div>
        
        <!-- Aba Dashboard -->
        <div class="tab-content active" id="dashboard-tab">
          <div class="panel-row">
            <div class="panel-main">
              <div class="chart-container">
                <div class="chart-header">
                  <h3 class="chart-title">Análise de Despesas</h3>
                </div>
                <div id="graficoDespesas"></div>
              </div>
            </div>
            
            <div class="panel-side">
              <div class="chart-container">
                <div class="chart-header">
                  <h3 class="chart-title">Despesas do Mês</h3>
                </div>
                <div id="listaDespesasMes" class="despesas-lista"></div>
              </div>
              
              <!-- Mini-Alertas -->
              <div class="chart-container">
                <div class="chart-header">
                  <h3 class="chart-title">Alertas</h3>
                  <button class="btn-icon" onclick="novo_verificarAlertas()">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
                <div class="mini-alerts" id="mini-alertas">
                  <!-- Preenchido dinamicamente -->
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Aba Despesas -->
        <div class="tab-content" id="despesas-tab">
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">Todas as Despesas</h3>
              <div class="d-flex gap-2">
                <div class="form-group mb-0">
                  <input type="text" id="filtroDescricao" class="form-control" placeholder="Filtrar por descrição">
                </div>
                <button class="btn btn-primary" onclick="filtrarTodasDespesas()">
                  <i class="fas fa-filter"></i>
                </button>
              </div>
            </div>
            <div class="table-container">
              <table id="todasDespesasTable">
                <thead>
                  <tr>
                    <th>Descrição</th>
                    <th>Valor</th>
                    <th>Data</th>
                    <th>Categoria</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="todasDespesasBody">
                  <!-- Preenchido dinamicamente -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Aba Relatórios -->
        <div class="tab-content" id="relatorio-tab">
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">Período do Relatório</h3>
              <div class="form-group mb-0">
                <input type="text" id="dataRange" class="form-control" placeholder="00/00/0000 - 00/00/0000">
              </div>
            </div>
          </div>
          
          <div class="panel-row">
            <div class="panel-main">
              <div class="chart-container">
                <div class="chart-header">
                  <h3 class="chart-title">Resumo Financeiro</h3>
                </div>
                <div id="relatorioMensalContainer"></div>
              </div>
            </div>
            
            <div class="panel-side">
              <div class="chart-container">
                <div class="chart-header">
                  <h3 class="chart-title">Despesas por Categoria</h3>
                </div>
                <div id="graficoCategorias"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Aba Previsões -->
        <div class="tab-content" id="previsao-tab">
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">Tendência de Gastos</h3>
            </div>
            <div id="novo_graficoPrevisao"></div>
          </div>
          
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">Próximos 3 Meses</h3>
            </div>
            <div id="novo_tabelaPrevisao"></div>
          </div>
        </div>
        
        <!-- Aba Calendário -->
        <div class="tab-content" id="calendario-tab">
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title" id="calendarTitulo">Calendário de Despesas</h3>
              <div class="d-flex gap-2">
                <button class="btn-icon" onclick="prevMonth()">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <button class="btn-icon" onclick="nextMonth()">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
            
            <div id="calendar-container">
              <div class="calendar-grid" id="calendarHeader">
                <!-- Cabeçalhos do calendário -->
                <div class="calendar-day-header">Dom</div>
                <div class="calendar-day-header">Seg</div>
                <div class="calendar-day-header">Ter</div>
                <div class="calendar-day-header">Qua</div>
                <div class="calendar-day-header">Qui</div>
                <div class="calendar-day-header">Sex</div>
                <div class="calendar-day-header">Sáb</div>
              </div>
              <div class="calendar-grid" id="calendarDays">
                <!-- Dias do calendário preenchidos dinamicamente -->
              </div>
            </div>
          </div>
          
          <div class="chart-container" id="dayDetailsContainer" style="display: none;">
            <div class="chart-header">
              <h3 class="chart-title" id="dayDetailsTitle">Detalhes do Dia</h3>
            </div>
            <div id="dayDetails"></div>
          </div>
        </div>
        
        <!-- Aba Categorias -->
        <div class="tab-content" id="categorias-tab">
          <div class="panel-row">
            <div class="panel-main">
              <div class="chart-container">
                <div class="chart-header">
                  <h3 class="chart-title">Categorias</h3>
                  <button class="btn btn-primary" onclick="abrirModal('categoriasModal')">
                    <i class="fas fa-plus"></i> Nova Categoria
                  </button>
                </div>
                <div class="table-container">
                  <table id="categoriasTable">
                    <thead>
                      <tr>
                        <th>Nome</th>
                        <th>Cor</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="categoriasBody">
                      <!-- Preenchido dinamicamente -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <div class="panel-side">
              <div class="chart-container">
                <div class="chart-header">
                  <h3 class="chart-title">Limites por Categoria</h3>
                  <button class="btn btn-outline" onclick="abrirModal('novo_limitesModal')">
                    <i class="fas fa-sliders"></i> Configurar
                  </button>
                </div>
                <div id="limitesCategorias">
                  <!-- Preenchido dinamicamente -->
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Aba Cartões -->
        <div class="tab-content" id="cartoes-tab">
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">Cartões de Crédito</h3>
              <button class="btn btn-primary" onclick="abrirModal('cartoesModal')">
                <i class="fas fa-plus"></i> Novo Cartão
              </button>
            </div>
            <div class="table-container">
              <table id="cartoesTable">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>Limite</th>
                    <th>Fechamento</th>
                    <th>Vencimento</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="cartoesBody">
                  <!-- Preenchido dinamicamente -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Aba Renda -->
        <div class="tab-content" id="renda-tab">
          <div class="panel-row">
            <div class="panel-main">
              <div class="chart-container">
                <div class="chart-header">
                  <h3 class="chart-title">Dados Pessoais</h3>
                  <button class="btn btn-primary" onclick="abrirModal('cadastroModal')">
                    <i class="fas fa-edit"></i> Editar
                  </button>
                </div>
                <div id="dadosPessoais">
                  <!-- Preenchido dinamicamente -->
                </div>
              </div>
            </div>
            
            <div class="panel-side">
              <div class="chart-container">
                <div class="chart-header">
                  <h3 class="chart-title">Rendas Adicionais</h3>
                  <button class="btn btn-outline" onclick="abrirModal('rendasModal')">
                    <i class="fas fa-plus"></i> Adicionar
                  </button>
                </div>
                <div id="rendasAdicionais">
                  <!-- Preenchido dinamicamente -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Botão de Ação Flutuante -->
      <button class="fab" onclick="abrirModal('cadastroDespesaModal')">
        <i class="fas fa-plus"></i>
      </button>
    </main>
  </div>
  
  <!-- Modais -->
  <!-- Modal de Cadastro de Despesa -->
  <div class="modal" id="cadastroDespesaModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Nova Despesa</h3>
        <button class="close" onclick="fecharModal('cadastroDespesaModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Descrição</label>
          <input type="text" id="descricaoDespesa" class="form-control" placeholder="Ex: Conta de Luz">
        </div>
        <div class="form-group">
          <label class="form-label">Valor</label>
          <input type="number" id="valorDespesa" class="form-control" step="0.01" min="0" placeholder="0.00">
        </div>
        <div class="form-group">
          <label class="form-label">Data de Vencimento</label>
          <input type="date" id="dataVencimento" class="form-control">
        </div>
        <div class="form-group">
          <label class="form-label">Categoria</label>
          <select id="categoriaDespesa" class="form-control">
            <!-- Preenchido dinamicamente -->
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Cartão (opcional)</label>
          <select id="cartaoDespesa" class="form-control">
            <option value="">Selecione um cartão</option>
            <!-- Preenchido dinamicamente -->
          </select>
        </div>
        <div class="form-group">
          <div class="d-flex align-center gap-2">
            <input type="checkbox" id="parcelamento" onchange="toggleParcelamento()">
            <label for="parcelamento">Parcelado</label>
          </div>
        </div>
        <div id="parcelamentoOptions" style="display: none;">
          <div class="form-group">
            <label class="form-label">Número de Parcelas</label>
            <input type="number" id="numParcelas" class="form-control" min="2" value="2">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('cadastroDespesaModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="salvarDespesa()">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal de Pagar Despesa -->
  <div class="modal" id="pagarDespesaModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Pagar Despesa</h3>
        <button class="close" onclick="fecharModal('pagarDespesaModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Despesa</label>
          <select id="despesaNaoPaga" class="form-control">
            <!-- Preenchido dinamicamente -->
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Data de Pagamento</label>
          <input type="date" id="dataPagamento" class="form-control">
        </div>
        <div class="form-group">
          <label class="form-label">Valor Pago</label>
          <input type="number" id="valorPago" class="form-control" step="0.01" min="0" placeholder="0.00">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="fecharModal('pagarDespesaModal')">Cancelar</button>
        <button class="btn btn-primary" onclick="pagarDespesa()">Pagar</button>
      </div>
    </div>
  </div>
  
  <!-- Outros modais (categorias, cartões, etc.) mantidos conforme original -->
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <!-- Moment.js para manipulação de datas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/pt-br.min.js"></script>
  
  <!-- DateRangePicker -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  
  <!-- Scripts personalizados -->
  <script src="js/auth.js"></script>
  <script src="js/main.js"></script>
  <script src="js/previsoes.js"></script>
  <script src="js/alertas.js"></script>
  
  <script>
    // Script para ativar/desativar o menu em dispositivos móveis
    document.getElementById('menuToggle').addEventListener('click', function() {
      document.getElementById('sidebar').classList.toggle('show');
    });
    
    // Script para ativar abas
    function activateTab(tabId) {
      // Desativa todas as abas
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
      });
      
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Ativa a aba selecionada
      document.querySelectorAll(`.tab-button[data-tab="${tabId}"]`).forEach(button => {
        button.classList.add('active');
      });
      
      const tabContent = document.getElementById(tabId);
      if (tabContent) {
        tabContent.classList.add('active');
      }
      
      // Ativa o item correspondente no menu lateral
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      
      const navLinks = document.querySelectorAll('.nav-link');
      for (let i = 0; i < navLinks.length; i++) {
        if (navLinks[i].getAttribute('onclick').includes(tabId)) {
          navLinks[i].classList.add('active');
          break;
        }
      }
      
      // Fechar o menu em dispositivos móveis após selecionar uma opção
      if (window.innerWidth <= 992) {
        document.getElementById('sidebar').classList.remove('show');
      }
      
      // Chamar funções específicas para cada aba
      if (tabId === 'dashboard-tab') {
        atualizarDashboard();
      } else if (tabId === 'despesas-tab') {
        loadTodasDespesas();
      } else if (tabId === 'relatorio-tab') {
        gerarRelatorio();
      } else if (tabId === 'previsao-tab') {
        novo_calcularPrevisoes();
      } else if (tabId === 'calendario-tab') {
        renderCalendar();
      } else if (tabId === 'categorias-tab') {
        loadCategorias();
      } else if (tabId === 'cartoes-tab') {
        loadCartoes();
      } else if (tabId === 'renda-tab') {
        loadRendas();
      }
    }
  </script>
</body>
</html>
